{
  "hash": "58d774184650334f325952aa92dfc74e",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n\n\n## DAG\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_75294556de1c2785523c518a46886270'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dagitty)\nlibrary(ggdag)\nlibrary(estimatr)\n\ndf <- readRDS(\"./Causal_Data_Science_Data/rand_enc.rds\")\n\ndag <- dagify(\n  \n  time_spent ~ unobserved,\n  time_spent ~ used_ftr,\n  used_ftr ~ rand_enc,\n  used_ftr ~ unobserved,\n  coords = list(x = c(used_ftr = 1, time_spent = 3, rand_enc = 0, unobserved = 2),\n                y = c(used_ftr = 1, time_spent = 1, rand_enc = 1, unobserved = 2))\n)\n\n# Plot DAG\nggdag(dag, text = F) +\n  geom_dag_point(color = \"blue\") +\n  geom_dag_text(color = NA) +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = name))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n## Naive estimate\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_a7203cc010892314cd1d2a18090d248b'}\n\n```{.r .cell-code}\n# Naive estimate\nlm_naive <- lm(time_spent ~ used_ftr, data = df)\nsummary(lm_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n## Correlations\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_ca6b4ac38979fc46adb8740246b4955a'}\n\n```{.r .cell-code}\n# Display correlations\nprint(cor(df))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>             rand_enc  used_ftr time_spent\n#> rand_enc   1.0000000 0.2044110  0.1296716\n#> used_ftr   0.2044110 1.0000000  0.7050147\n#> time_spent 0.1296716 0.7050147  1.0000000\n```\n:::\n:::\n\nUsing IV is adequate, because the instrumental variable rand_enc is somewhat correlated to the treatment variable. This means the instrumental relevance is satisfied. It can therefore help to display the effect of the unknown variables. As for the other assumptions, they should be satisfied but we cannot be a 100% certain.\n\n## IV\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_75c6c71a8cd787c2fb396f319822229c'}\n\n```{.r .cell-code}\n# IV estimate using 2SLS\niv_model <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df)\n\n# Display the IV estimate\nsummary(iv_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = df)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThe treatment effect for the iv model is slightly higher than the biased model. That means there is a downward bias, but it is rather small.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}