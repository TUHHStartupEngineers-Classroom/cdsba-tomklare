{
  "hash": "ad88f6124b11b6f8027ce9f8ee43e680",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\n---\n\n\n## Manually compute differences\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_4b6c0fa3dfc58f55d800a4d460b5e8ce'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(dagitty)\nlibrary(ggdag)\n\ndf <- readRDS(\"./Causal_Data_Science_Data/hospdd.rds\")\n\n# Manually compute differences\n# Step 1: Difference between treatment and control group BEFORE treatment\nbefore_control <- df[df$hospital>18, ] %>%\n  filter(month < 4) %>% \n  pull(satis) %>% \n  mean()\n\nbefore_treatment <- df[df$hospital<=18, ] %>%\n  filter(month < 4) %>% \n  pull(satis) %>% \n  mean()\n\ndiff_before <- before_treatment - before_control\n\n# Step 2: Difference between treatment and control group AFTER treatment\nafter_control <- df[df$hospital>18, ] %>%\n  filter(month >= 4) %>% \n  pull(satis) %>% \n  mean()\n\nafter_treatment <- df[df$hospital<=18, ] %>%\n  filter(month >= 4) %>% \n  pull(satis) %>% \n  mean()\n\ndiff_after <- after_treatment - after_control\n\n# Step 3: Difference-in-differences.\ndiff_diff <- diff_after - diff_before\nsprintf(\"Estimate: %.2f\", diff_diff)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"Estimate: 0.85\"\n```\n:::\n:::\n\n\n## Regression model\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_5b141c1e1d3baa1d934e89d9f2940b59'}\n\n```{.r .cell-code}\nlm <- lm(satis ~ procedure * month + as.factor(month) + as.factor(hospital), data = df)\nsummary(lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ procedure * month + as.factor(month) + as.factor(hospital), \n#>     data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.1880 -0.4642  0.0062  0.4545  4.3066 \n#> \n#> Coefficients: (1 not defined because of singularities)\n#>                         Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)            3.1752470  0.0569452  55.760  < 2e-16 ***\n#> procedure              0.7567463  0.1238559   6.110 1.05e-09 ***\n#> month                 -0.0035904  0.0058646  -0.612 0.540414    \n#> as.factor(month)2     -0.0060173  0.0281595  -0.214 0.830798    \n#> as.factor(month)3      0.0291493  0.0283075   1.030 0.303167    \n#> as.factor(month)4      0.0178353  0.0352558   0.506 0.612953    \n#> as.factor(month)5      0.0084081  0.0325291   0.258 0.796044    \n#> as.factor(month)6      0.0106650  0.0319859   0.333 0.738822    \n#> as.factor(month)7             NA         NA      NA       NA    \n#> as.factor(hospital)2   0.4085664  0.0772439   5.289 1.26e-07 ***\n#> as.factor(hospital)3   0.5336248  0.0793406   6.726 1.88e-11 ***\n#> as.factor(hospital)4   0.2275102  0.0739432   3.077 0.002100 ** \n#> as.factor(hospital)5  -0.1453529  0.0739432  -1.966 0.049367 *  \n#> as.factor(hospital)6   0.4478634  0.0739432   6.057 1.46e-09 ***\n#> as.factor(hospital)7   1.4044164  0.0714579  19.654  < 2e-16 ***\n#> as.factor(hospital)8   0.0718758  0.0763207   0.942 0.346347    \n#> as.factor(hospital)9  -1.5185150  0.0782469 -19.407  < 2e-16 ***\n#> as.factor(hospital)10  1.6828446  0.0772439  21.786  < 2e-16 ***\n#> as.factor(hospital)11  0.2209653  0.0763207   2.895 0.003800 ** \n#> as.factor(hospital)12 -0.0953034  0.0782469  -1.218 0.223269    \n#> as.factor(hospital)13  0.4955931  0.0754680   6.567 5.49e-11 ***\n#> as.factor(hospital)14  0.2330426  0.0793406   2.937 0.003322 ** \n#> as.factor(hospital)15 -0.1444935  0.0793406  -1.821 0.068620 .  \n#> as.factor(hospital)16  1.4142680  0.0772439  18.309  < 2e-16 ***\n#> as.factor(hospital)17  0.4235429  0.0805385   5.259 1.49e-07 ***\n#> as.factor(hospital)18  0.1532761  0.0938190   1.634 0.102356    \n#> as.factor(hospital)19 -0.7453017  0.0811646  -9.183  < 2e-16 ***\n#> as.factor(hospital)20  0.0473874  0.0791162   0.599 0.549219    \n#> as.factor(hospital)21  1.1943370  0.0836256  14.282  < 2e-16 ***\n#> as.factor(hospital)22  0.7993153  0.0823359   9.708  < 2e-16 ***\n#> as.factor(hospital)23  0.7017202  0.0811646   8.646  < 2e-16 ***\n#> as.factor(hospital)24 -0.3081260  0.0866426  -3.556 0.000379 ***\n#> as.factor(hospital)25  0.6464736  0.0927285   6.972 3.40e-12 ***\n#> as.factor(hospital)26  0.2142471  0.0791162   2.708 0.006785 ** \n#> as.factor(hospital)27 -0.3986544  0.0766128  -5.203 2.01e-07 ***\n#> as.factor(hospital)28  0.7119953  0.0836256   8.514  < 2e-16 ***\n#> as.factor(hospital)29  0.2485512  0.0800957   3.103 0.001922 ** \n#> as.factor(hospital)30 -0.1679220  0.0953664  -1.761 0.078313 .  \n#> as.factor(hospital)31  0.5120848  0.0791162   6.473 1.03e-10 ***\n#> as.factor(hospital)32 -0.3233456  0.0800957  -4.037 5.47e-05 ***\n#> as.factor(hospital)33 -0.4539752  0.0791162  -5.738 9.96e-09 ***\n#> as.factor(hospital)34 -0.0004123  0.0746075  -0.006 0.995590    \n#> as.factor(hospital)35  0.3541110  0.0766128   4.622 3.86e-06 ***\n#> as.factor(hospital)36  2.1381425  0.0773833  27.631  < 2e-16 ***\n#> as.factor(hospital)37  0.1404036  0.0927285   1.514 0.130034    \n#> as.factor(hospital)38 -0.0868060  0.0782151  -1.110 0.267106    \n#> as.factor(hospital)39 -0.0234969  0.0823359  -0.285 0.775362    \n#> as.factor(hospital)40  1.1215331  0.0782151  14.339  < 2e-16 ***\n#> as.factor(hospital)41 -0.1497346  0.0766128  -1.954 0.050688 .  \n#> as.factor(hospital)42  0.8811369  0.0850532  10.360  < 2e-16 ***\n#> as.factor(hospital)43 -0.7724325  0.0811646  -9.517  < 2e-16 ***\n#> as.factor(hospital)44  0.0344120  0.0904362   0.381 0.703577    \n#> as.factor(hospital)45 -0.2137495  0.0766128  -2.790 0.005284 ** \n#> as.factor(hospital)46  0.0784915  0.0823359   0.953 0.340466    \n#> procedure:month        0.0165894  0.0216427   0.767 0.443396    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7239 on 7314 degrees of freedom\n#> Multiple R-squared:  0.5333,\tAdjusted R-squared:  0.5299 \n#> F-statistic: 157.7 on 53 and 7314 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nUsing factors for hospital and month parameters helps to include fixed effects. \nThese fixed effects help to control time-invariant characteristics between the treatment and control group. \n\nAs can be seen, the two calculated values for the treatment effect are pretty similar.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}